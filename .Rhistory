"Deaths were identified using the International Classification of Diseases, Tenth Revision (ICD-10) multiple-cause coding.",
"Sepsis-related deaths were defined using ICD-10 codes A40–A41. Renal failure–related deaths were defined using ICD-10 codes",
"N17. Deaths in which both sepsis and renal failure codes appeared on the same death certificate were classified as the",
"combined sepsis and renal failure group."
),
style = "Normal"
)
# ---- Study population and data extraction ----
doc <- body_add_par(doc, "Study population and data extraction", style = "heading 2")
doc <- body_add_par(
doc,
paste(
"Annual mortality and population denominator data were extracted for all 50 U.S. states and the District of Columbia from 2010",
"through 2025. Analyses were restricted to individuals aged 25 years and older, using CDC WONDER 10-year age groups (25–34,",
"35–44, 45–54, 55–64, 65–74, 75–84, and 85 years and older). Stratified analyses were conducted by sex and race."
),
style = "Normal"
)
doc <- body_add_par(
doc,
paste(
"Race and ethnicity were harmonized using the “Race” and “Single Race 6” variables when available. Individuals classified as",
"“Asian or Pacific Islander” were grouped as Asian, while Native Hawaiian or Other Pacific Islander was retained as a separate",
"category. Records with unavailable or suppressed race information were excluded from race-stratified analyses."
),
style = "Normal"
)
# ---- Statistical analysis ----
doc <- body_add_par(doc, "Statistical analysis", style = "heading 2")
doc <- body_add_par(
doc,
paste(
"Mortality was summarized using age-adjusted mortality rates (AAMRs).",
"AAMRs per 100,000 population were calculated by direct standardization to the 2000 U.S. standard population using CDC standard",
"million weights for 10-year age groups from 25–34 through 85 years and older. Age-specific mortality rates were multiplied by",
"the corresponding standard weights and summed to obtain AAMRs."
),
style = "Normal"
)
doc <- body_add_par(
doc,
paste(
"To assess temporal patterns, four pandemic-related periods were defined: pre-pandemic (2010–2019), pandemic (2020–2022),",
"transition (2023), and post-pandemic (2024–2025). Period-specific crude mortality rates were calculated using aggregated deaths",
"and population denominators. Period-specific AAMRs were calculated by aggregating age-specific deaths and populations and",
"applying direct standardization. State-level AAMRs were computed using the same approach to facilitate geographic comparisons."
),
style = "Normal"
)
# ---- Growth rate formula (Word-friendly) ----
doc <- body_add_par(
doc,
"To quantify changes relative to baseline mortality, the relative growth in AAMR at the peak year and in 2025 was calculated in reference to the pre-pandemic average AAMR from 2010 to 2019 using the following formula:",
style = "Normal"
)
# Put the “equation” as a separate line for readability (portable across Word versions)
doc <- body_add_par(
doc,
"Growth rate = (AAMR_t − mean(AAMR_2010–2019)) / mean(AAMR_2010–2019)",
style = "Normal"
)
# ---- Software and reproducibility ----
doc <- body_add_par(doc, "Software and reproducibility", style = "heading 2")
doc <- body_add_par(
doc,
paste(
"All data management, statistical analyses, and figure generation were conducted using R version 4.5.0 (R Foundation for Statistical Computing).",
"Data cleaning and aggregation were performed using the tidyverse suite of packages, and visualizations were created using ggplot2",
"and related packages. All analyses were performed using scripted workflows to ensure reproducibility. The analytic code used in this",
"study is available upon reasonable request."
),
style = "Normal"
)
# ---- Save the document ----
print(doc, target = "Methods_section.docx")
library(readr)
library(tidyverse)
library(lubridate)
library(splines)
library(broom)
library(usmap)
library(scales)
library(ggplot2)
library(sf)
library(tigris)
library(dplyr)
library(tidyr)
stateN172010 <- read_csv("Data/stateN172010.csv")
stateN172018 <- read_csv("Data/stateN172018.csv")
clean_year <- function(df) {
df %>%
mutate(
Year_raw = as.character(Year),
# pull the first 4-digit year (e.g., "2024 (provisional)" -> 2024)
Year = readr::parse_number(Year_raw),
# keep any extra text as a note (optional)
Year_note = str_squish(str_remove(Year_raw, "^\\d{4}"))
)
}
N17 <- bind_rows(
clean_year(stateN172010),
clean_year(stateN172018)
) %>%
select(-Year_raw)
stateA402010 <- read_csv("Data/stateA402010.csv")
stateA402018 <- read_csv("Data/stateA402018.csv")
A40 <- bind_rows(
clean_year(stateA402010),
clean_year(stateA402018)
) %>%
select(-Year_raw)
stateN17A402010 <- read_csv("Data/stateN17A402010.csv")
stateN17A402018 <- read_csv("Data/stateN17A402018.csv")
N17A40 <- bind_rows(
clean_year(stateN17A402010),
clean_year(stateN17A402018)
) %>%
select(-Year_raw)
options(tigris_use_cache = TRUE)
std2000_25plus <- tibble::tibble(
age_code   = c("25-34", "35-44", "45-54", "55-64", "65-74", "75-84", "85+"),
std_million = c(135573, 162613, 134834, 87247, 66037, 44842, 15508)
) %>%
mutate(weight = std_million / sum(std_million))  # normalize within 25–85+
period_map <- tibble::tibble(
period_id = 1:4,
period = c("Pre-pandemic (2010–2019)",
"Pandemic (2020–2022)",
"Transition (2023)",
"Post-pandemic (2024–2025)"),
year_start = c(2010, 2020, 2023, 2024),
year_end   = c(2019, 2022, 2023, 2025)
)
add_period4 <- function(x) {
x %>%
left_join(period_map, join_by(Year >= year_start, Year <= year_end)) %>%
filter(!is.na(period)) %>%
mutate(period = factor(period, levels = period_map$period))
}
calc_state_period_aamr <- function(df, outcome_label, subchapter_filter = NULL) {
x <- df %>%
dplyr::filter(is.na(Notes) | Notes != "Total",
Year >= 2010, Year <= 2025) %>%
dplyr::mutate(
State_use = dplyr::coalesce(State, `Residence State`)
) %>%
dplyr::filter(!is.na(State_use), State_use != "United States")
if (!is.null(subchapter_filter)) {
x <- x %>% dplyr::filter(`MCD - ICD Sub-Chapter` %in% subchapter_filter)
}
x %>%
dplyr::mutate(age_code = `Ten-Year Age Groups Code`) %>%
dplyr::filter(age_code %in% std2000_25plus$age_code) %>%
add_period4() %>%
dplyr::group_by(State_use, period, age_code) %>%
dplyr::summarise(
deaths = sum(Deaths, na.rm = TRUE),
pop    = sum(Population, na.rm = TRUE),
.groups = "drop"
) %>%
dplyr::left_join(std2000_25plus, by = "age_code") %>%
dplyr::mutate(age_rate = dplyr::if_else(pop > 0, (deaths / pop) * 1e5, NA_real_)) %>%
dplyr::group_by(State_use, period) %>%
dplyr::summarise(AAMR = sum(age_rate * weight, na.rm = TRUE), .groups = "drop") %>%
dplyr::rename(State = State_use) %>%
dplyr::mutate(outcome = outcome_label)
}
state_period_aamr <- dplyr::bind_rows(
calc_state_period_aamr(N17, "ARF", subchapter_filter = "Renal failure"),
calc_state_period_aamr(A40, "Sepsis", subchapter_filter = "Other bacterial diseases"),
calc_state_period_aamr(N17A40, "ARF & sepsis",subchapter_filter = "Renal failure")
) %>%
dplyr::mutate(
outcome = factor(outcome, levels = c("ARF", "Sepsis", "ARF & sepsis"))
)
# Should be 0 after fix
sum(is.na(state_period_aamr$State))
# See which states are missing by period/outcome (if any)
state_period_aamr %>%
count(outcome, period) %>%
arrange(outcome, period)
# Convert State name -> state abbreviation (needed for usmap)
# Get fips_info as a data frame (works whether it's an object or a function)
fi <- usmap::fips_info
if (is.function(fi)) fi <- usmap::fips_info()
state_period_aamr_usmap <- state_period_aamr %>%
dplyr::left_join(
fi %>% dplyr::select(full, abbr),
by = c("State" = "full")
) %>%
dplyr::rename(state = abbr) %>%
dplyr::select(state, period, outcome, AAMR)
make_outcome_map <- function(df, outcome_name, low_col, high_col) {
df_out  <- df %>% filter(outcome == outcome_name)
max_out <- max(df_out$AAMR, na.rm = TRUE)
plot_usmap(
regions = "states",
data    = df_out,
values  = "AAMR",
color   = "grey60",
size    = 0.2
) +
facet_grid(period ~ .) +
scale_fill_gradient(
low      = low_col,
high     = high_col,
limits   = c(0, max_out),
oob      = scales::squish,
breaks   = pretty(c(0, max_out), n = 5),
labels   = scales::number_format(accuracy = 1),
na.value = "grey90"
) +
guides(
fill = guide_colorbar(
title.position = "top",
title.hjust    = 0.5,
barwidth       = unit(6, "cm"),
barheight      = unit(0.6, "cm")
)
) +
labs(
title = paste0("Age-Adjusted Mortality Rate (25–85+): ", outcome_name),
subtitle = paste0("Scale: 0–", round(max_out, 0), " per 100,000"),
fill  = "AAMR per 100,000"
) +
theme_minimal(base_size = 12) +
theme(
plot.title    = element_text(face = "bold", color = high_col),
plot.subtitle = element_text(color = "grey30"),
strip.text    = element_text(face = "bold", color = high_col),
legend.position = "bottom",
legend.title   = element_text(face = "bold"),
panel.grid     = element_blank()
)
}
map_arf <- make_outcome_map(
state_period_aamr_usmap,
outcome_name = "ARF",
low_col  = "#f7fbff",
high_col = "#08306b"
)
map_sepsis <- make_outcome_map(
state_period_aamr_usmap,
outcome_name = "Sepsis",
low_col  = "#f2f0f7",
high_col = "#54278f"
)
map_arf_sepsis <- make_outcome_map(
state_period_aamr_usmap,
outcome_name = "ARF & sepsis",   # change if needed
low_col  = "#edf8fb",
high_col = "#006d6f"
)
map_arf
map_sepsis
map_arf_sepsis
map_arf <- make_outcome_map(
state_period_aamr_usmap,
outcome_name = "ARF",
low_col  = "#f7fbff",
high_col = "#08306b"
)
map_sepsis <- make_outcome_map(
state_period_aamr_usmap,
outcome_name = "Sepsis",
low_col  = "#f2f0f7",
high_col = "#54278f"
)
map_arf_sepsis <- make_outcome_map(
state_period_aamr_usmap,
outcome_name = "ARF & sepsis",
low_col  = "#f1eef6",
high_col = "#4a1486"
)
map_arf
map_sepsis
map_arf_sepsis
map_arf <- make_outcome_map(
state_period_aamr_usmap,
outcome_name = "ARF",
low_col  = "#f7fbff",
high_col = "#08306b"
)
map_arf_sepsis <- make_outcome_map(
state_period_aamr_usmap,
outcome_name = "ARF & sepsis",
low_col  = "#e5f5f9",
high_col = "#2b8cbe"
)
map_arf_sepsis <- make_outcome_map(
state_period_aamr_usmap,
outcome_name = "ARF & sepsis",
low_col  = "#f1eef6",
high_col = "#4a1486"
)
map_arf
map_sepsis
map_arf_sepsis
map_arf <- make_outcome_map(
state_period_aamr_usmap,
outcome_name = "ARF",
low_col  = "#f7fbff",
high_col = "#08306b"
)
map_sepsis <- make_outcome_map(
state_period_aamr_usmap,
outcome_name = "Sepsis",
low_col  = "#f2f0f7",
high_col = "#54278f"
)
map_arf_sepsis <- make_outcome_map(
state_period_aamr_usmap,
outcome_name = "ARF & sepsis",
low_col  = "#e5f5f9",
high_col = "#2b8cbe"
)
map_arf
map_sepsis
map_arf_sepsis
library(ggplot2)
library(patchwork)
combined_plot <-
(map_arf | map_sepsis | map_arf_sepsis) +
plot_annotation(
title = "Age-Adjusted Mortality Rate (25–85+) by Outcome and Pandemic Period",
theme = ggplot2::theme(
plot.title = ggplot2::element_text(
face = "bold",
size = 14,
hjust = 0.5
)
)
)
ggsave(
filename = "AAMR_maps_ARF_Sepsis_combined.png",
plot     = combined_plot,
width    = 14,      # inches (3 panels side by side)
height   = 8,
dpi      = 300,
bg       = "white"
)
make_outcome_map <- function(df, outcome_name, low_col, high_col) {
df_out  <- df %>% filter(outcome == outcome_name)
max_out <- max(df_out$AAMR, na.rm = TRUE)
plot_usmap(
regions = "states",
data    = df_out,
values  = "AAMR",
color   = "grey60",
size    = 0.2
) +
facet_grid(period ~ .) +
scale_fill_gradient(
low      = low_col,
high     = high_col,
limits   = c(0, max_out),
oob      = scales::squish,
breaks   = pretty(c(0, max_out), n = 5),
labels   = scales::number_format(accuracy = 1),
na.value = "grey90"
) +
guides(
fill = guide_colorbar(
title.position = "top",
title.hjust    = 0.5,
barwidth       = unit(6, "cm"),
barheight      = unit(0.6, "cm")
)
) +
labs(
title = paste0("Age-Adjusted Mortality Rate: ", outcome_name),
subtitle = paste0("Scale: 0–", round(max_out, 0), " per 100,000"),
fill  = "AAMR"
) +
theme_minimal(base_size = 12) +
theme(
plot.title    = element_text(face = "bold", color = high_col),
plot.subtitle = element_text(color = "grey30"),
strip.text    = element_text(face = "bold", color = high_col),
legend.position = "bottom",
legend.title   = element_text(face = "bold"),
panel.grid     = element_blank()
)
}
map_arf <- make_outcome_map(
state_period_aamr_usmap,
outcome_name = "ARF",
low_col  = "#f7fbff",
high_col = "#08306b"
)
map_sepsis <- make_outcome_map(
state_period_aamr_usmap,
outcome_name = "Sepsis",
low_col  = "#f2f0f7",
high_col = "#54278f"
)
map_arf_sepsis <- make_outcome_map(
state_period_aamr_usmap,
outcome_name = "ARF & sepsis",
low_col  = "#e5f5f9",
high_col = "#2b8cbe"
)
map_arf
map_sepsis
map_arf_sepsis
make_outcome_map <- function(df, outcome_name, low_col, high_col) {
df_out  <- df %>% filter(outcome == outcome_name)
max_out <- max(df_out$AAMR, na.rm = TRUE)
plot_usmap(
regions = "states",
data    = df_out,
values  = "AAMR",
color   = "grey60",
size    = 0.2
) +
facet_grid(period ~ .) +
scale_fill_gradient(
low      = low_col,
high     = high_col,
limits   = c(0, max_out),
oob      = scales::squish,
breaks   = pretty(c(0, max_out), n = 5),
labels   = scales::number_format(accuracy = 1),
na.value = "grey90"
) +
guides(
fill = guide_colorbar(
title.position = "top",
title.hjust    = 0.5,
barwidth       = unit(6, "cm"),
barheight      = unit(0.6, "cm")
)
) +
labs(
title = paste0("AAMR: ", outcome_name),
subtitle = paste0("Scale: 0–", round(max_out, 0), " per 100,000"),
fill  = "AAMR"
) +
theme_minimal(base_size = 12) +
theme(
plot.title    = element_text(face = "bold", color = high_col),
plot.subtitle = element_text(color = "grey30"),
strip.text    = element_text(face = "bold", color = high_col),
legend.position = "bottom",
legend.title   = element_text(face = "bold"),
panel.grid     = element_blank()
)
}
map_arf <- make_outcome_map(
state_period_aamr_usmap,
outcome_name = "ARF",
low_col  = "#f7fbff",
high_col = "#08306b"
)
map_sepsis <- make_outcome_map(
state_period_aamr_usmap,
outcome_name = "Sepsis",
low_col  = "#f2f0f7",
high_col = "#54278f"
)
map_arf_sepsis <- make_outcome_map(
state_period_aamr_usmap,
outcome_name = "ARF & sepsis",
low_col  = "#e5f5f9",
high_col = "#2b8cbe"
)
map_arf
map_sepsis
map_arf_sepsis
library(ggplot2)
library(patchwork)
combined_plot <-
(map_arf | map_sepsis | map_arf_sepsis) +
plot_annotation(
title = "Age-Adjusted Mortality Rate by Outcome and Pandemic Period",
theme = ggplot2::theme(
plot.title = ggplot2::element_text(
face = "bold",
size = 14,
hjust = 0.5
)
)
)
ggsave(
filename = "AAMR_maps_ARF_Sepsis_combined.png",
plot     = combined_plot,
width    = 14,      # inches (3 panels side by side)
height   = 8,
dpi      = 300,
bg       = "white"
)
map_arf <- make_outcome_map(
state_period_aamr_usmap,
outcome_name = "ARF",
low_col  = "#f7fbff",
high_col = "#08306b"
)
map_sepsis <- make_outcome_map(
state_period_aamr_usmap,
outcome_name = "Sepsis",
low_col  = "#f2f0f7",
high_col = "#54278f"
)
map_arf_sepsis <- make_outcome_map(
state_period_aamr_usmap,
outcome_name = "ARF & sepsis",
low_col  = "#f2e5ff",
high_col = "#54278f"
)
map_arf
map_sepsis
map_arf_sepsis
