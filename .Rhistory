filter(Year == 2019) %>%
mutate(period = "2019 (Pre-COVID)"),
sepsis_trend %>%
filter(Year %in% c(2020, 2021)) %>%
slice_max(crude_rate, n = 1) %>%
mutate(period = "COVID peak (2020–2021)"),
sepsis_trend %>%
filter(Year == max(Year)) %>%
mutate(period = "Latest year")
) %>%
transmute(
Group = "Sepsis (A40–A41)",
period,
crude_rate = round(crude_rate, 1)
)
renal_sepsis_key <- bind_rows(
renal_sepsis_trend %>%
filter(Year == 2019) %>%
mutate(period = "2019 (Pre-COVID)"),
renal_sepsis_trend %>%
filter(Year %in% c(2020, 2021)) %>%
group_by(group) %>%
slice_max(crude_rate, n = 1) %>%
ungroup() %>%
mutate(period = "COVID peak (2020–2021)"),
renal_sepsis_trend %>%
filter(Year == max(Year)) %>%
mutate(period = "Latest year")
) %>%
select(Group = group, period, crude_rate) %>%
mutate(crude_rate = round(crude_rate, 1))
renal_covid_key <- bind_rows(
covid_trend %>%
filter(Year == min(Year)) %>%
mutate(period = "Baseline"),
covid_trend %>%
group_by(group) %>%
slice_max(crude_rate, n = 1) %>%
ungroup() %>%
mutate(period = "Peak"),
covid_trend %>%
filter(Year == max(Year)) %>%
mutate(period = "Latest year")
) %>%
select(Group = group, period, crude_rate) %>%
mutate(crude_rate = round(crude_rate, 1))
important_numbers <- bind_rows(
mutate(renal_key, Analysis = "Renal only"),
mutate(sepsis_key, Analysis = "Sepsis"),
mutate(renal_sepsis_key, Analysis = "Renal + Sepsis"),
mutate(renal_covid_key, Analysis = "Renal + COVID")
)
important_numbers
library(writexl)
write_xlsx(
important_numbers,
"important_numbers_trends.xlsx"
)
dir.create("figures", showWarnings = FALSE)
dpi_pub <- 600   # journal standard
width  <- 7      # inches
height <- 5
ggsave(
filename = "figures/fig_renal_trend.tiff",
plot = renal_plot,          # <-- your renal-only ggplot object
device = "tiff",
dpi = dpi_pub,
width = width,
height = height,
units = "in",
compression = "lzw"
)
renal_plot <- ggplot(renal_by_group, aes(x = Year, y = crude_rate, color = renal_group)) +
# COVID shading (behind data)
annotate(
"rect",
xmin = 2020, xmax = 2021.99,
ymin = -Inf, ymax = Inf,
fill = "grey70", alpha = 0.12
) +
# Trend lines
geom_line(linewidth = 1.3) +
# Axis formatting
scale_x_continuous(
breaks = seq(min(renal_by_group$Year),
max(renal_by_group$Year), by = 2)
) +
scale_color_manual(
values = c(
"AKI (N17)" = "#1b9e77",
"CKD (N18)" = "#7570b3",
"Unspecified renal failure (N19)" = "#d95f02"
)
) +
labs(
x = NULL,
y = "Crude mortality rate (per 100,000 population)",
color = NULL,
title = "Trends in renal failure–related mortality in the United States",
subtitle = "Acute kidney injury (N17), chronic kidney disease (N18), and unspecified renal failure (N19)\nShaded region indicates the COVID-19 period (2020–2021)"
) +
theme_minimal(base_size = 13) +
theme(
panel.grid.minor = element_blank(),
panel.grid.major.x = element_blank(),
axis.text = element_text(color = "black"),
plot.title = element_text(face = "bold", size = 14),
legend.position = "top",
legend.text = element_text(size = 11)
)
ggsave(
filename = "figures/fig_renal_trend.tiff",
plot = renal_plot,          # <-- your renal-only ggplot object
device = "tiff",
dpi = dpi_pub,
width = width,
height = height,
units = "in",
compression = "lzw"
)
library(ggplot2)
sepsis_plot <- ggplot(sepsis_trend, aes(x = Year, y = crude_rate)) +
annotate(
"rect",
xmin = 2020, xmax = 2021.99,
ymin = -Inf, ymax = Inf,
fill = "grey70", alpha = 0.12
) +
geom_line(linewidth = 1.3, color = "#1b9e77") +
labs(
x = NULL,
y = "Crude mortality rate (per 100,000 population)",
title = "Trends in sepsis-related mortality in the United States",
subtitle = "Based on ICD-10 codes A40–A41; shaded area indicates COVID-19 period (2020–2021)"
) +
scale_x_continuous(
breaks = seq(min(sepsis_trend$Year),
max(sepsis_trend$Year), by = 2)
) +
theme_minimal(base_size = 13) +
theme(
panel.grid.minor = element_blank(),
panel.grid.major.x = element_blank(),
axis.text = element_text(color = "black"),
plot.title = element_text(face = "bold", size = 14)
)
ggsave(
filename = "fig_sepsis_trend.tiff",
plot = sepsis_plot,
device = "tiff",
dpi = dpi_pub,
width = width,
height = height,
units = "in",
compression = "lzw"
)
yr_min <- min(renal_sepsis_trend$Year, na.rm = TRUE)
yr_max <- max(renal_sepsis_trend$Year, na.rm = TRUE)
renal_sepsis_plot <- ggplot(renal_sepsis_trend, aes(x = Year, y = crude_rate, color = group)) +
annotate(
"rect",
xmin = 2020, xmax = 2021.99,
ymin = -Inf, ymax = Inf,
fill = "grey70", alpha = 0.12
) +
geom_line(linewidth = 1.3) +
scale_x_continuous(breaks = seq(yr_min, yr_max, by = 2)) +
scale_color_manual(
values = c(
"AKI (N17)" = "#1b9e77",
"CKD (N18)" = "#7570b3",
"Unspecified renal failure (N19)" = "#d95f02",
"Sepsis (A40–A41)" = "#666666"
)
) +
labs(
x = NULL,
y = "Crude mortality rate (per 100,000 population)",
color = NULL,
title = "Trends in renal failure and sepsis–related mortality in the United States",
subtitle = "AKI (N17), CKD (N18), unspecified renal failure (N19), and sepsis (A40–A41)\nShaded region indicates the COVID-19 period (2020–2021)"
) +
theme_minimal(base_size = 13) +
theme(
panel.grid.minor = element_blank(),
panel.grid.major.x = element_blank(),
axis.text = element_text(color = "black"),
plot.title = element_text(face = "bold", size = 14),
legend.position = "top"
)
ggsave(
filename = "fig_renal_sepsis_trend.tiff",
plot = renal_sepsis_plot,
device = "tiff",
dpi = dpi_pub,
width = width,
height = height,
units = "in",
compression = "lzw"
)
yr_min <- min(covid_trend$Year, na.rm = TRUE)
yr_max <- max(covid_trend$Year, na.rm = TRUE)
covid_plot <- ggplot(covid_trend, aes(x = Year, y = crude_rate, color = group)) +
geom_line(linewidth = 1.3) +
scale_color_manual(
values = c(
"AKI (N17)" = "#1b9e77",
"CKD (N18)" = "#7570b3",
"Unspecified renal failure (N19)" = "#d95f02",
"COVID-19 (U07.1)" = "#4d4d4d"
)
) +
scale_x_continuous(breaks = seq(yr_min, yr_max, by = 1)) +
labs(
x = NULL,
y = "Crude mortality rate (per 100,000 population)",
color = NULL,
title = "Trends in renal failure and COVID-19–related mortality",
subtitle = "United States, 2020–2022+; based on ICD-10 multiple cause of death codes"
) +
theme_minimal(base_size = 13) +
theme(
panel.grid.minor = element_blank(),
panel.grid.major.x = element_blank(),
axis.text = element_text(color = "black"),
plot.title = element_text(face = "bold", size = 14),
legend.position = "top"
)
ggsave(
filename = "fig_renal_covid_trend.tiff",
plot = covid_plot,
device = "tiff",
dpi = dpi_pub,
width = width,
height = height,
units = "in",
compression = "lzw"
)
ggsave(
filename = "figures/fig_renal_trend.tiff",
plot = renal_plot,          # <-- your renal-only ggplot object
device = "tiff",
dpi = dpi_pub,
width = width,
height = height,
units = "in",
compression = "lzw"
)
renal_plot <- ggplot(renal_by_group, aes(x = Year, y = crude_rate, color = renal_group)) +
# COVID shading (behind data)
annotate(
"rect",
xmin = 2020, xmax = 2021.99,
ymin = -Inf, ymax = Inf,
fill = "grey70", alpha = 0.12
) +
# Trend lines
geom_line(linewidth = 1.3) +
# Axis formatting
scale_x_continuous(
breaks = seq(min(renal_by_group$Year),
max(renal_by_group$Year), by = 2)
) +
scale_color_manual(
values = c(
"AKI (N17)" = "#1b9e77",
"CKD (N18)" = "#7570b3",
"Unspecified renal failure (N19)" = "#d95f02"
)
) +
labs(
x = NULL,
y = "Crude mortality rate (per 100,000 population)",
color = NULL,
title = "Trends in renal failure–related mortality in the United States",
subtitle = "Acute kidney injury (N17), chronic kidney disease (N18), and unspecified renal failure (N19)\nShaded region indicates the COVID-19 period (2020–2021)"
) +
theme_minimal(base_size = 13) +
theme(
panel.grid.minor = element_blank(),
panel.grid.major.x = element_blank(),
axis.text = element_text(color = "black"),
plot.title = element_text(face = "bold", size = 14),
legend.position = "top",
legend.text = element_text(size = 11)
)
ggsave(
filename = "figures/fig_renal_trend.tiff",
plot = renal_plot,          # <-- your renal-only ggplot object
device = "tiff",
dpi = dpi_pub,
width = width,
height = height,
units = "in",
compression = "lzw"
)
ggsave(
filename = "figures/fig_sepsis_trend.tiff",
plot = sepsis_plot,
device = "tiff",
dpi = dpi_pub,
width = width,
height = height,
units = "in",
compression = "lzw"
)
ggsave(
filename = "figures/fig_renal_sepsis_trend.tiff",
plot = renal_sepsis_plot,
device = "tiff",
dpi = dpi_pub,
width = width,
height = height,
units = "in",
compression = "lzw"
)
ggsave(
filename = "figures/fig_renal_covid_trend.tiff",
plot = covid_plot,
device = "tiff",
dpi = dpi_pub,
width = width,
height = height,
units = "in",
compression = "lzw"
)
library(dplyr)
facet_trend <- bind_rows(
renal_by_group %>%
transmute(
Year,
Group = renal_group,
crude_rate,
Panel = "A. Renal only (AKI / CKD / N19)"
),
sepsis_trend %>%
transmute(
Year,
Group = "Sepsis (A40–A41)",
crude_rate,
Panel = "B. Sepsis"
),
renal_sepsis_trend %>%
transmute(
Year,
Group = group,
crude_rate,
Panel = "C. Renal + Sepsis"
),
covid_trend %>%
transmute(
Year,
Group = group,
crude_rate,
Panel = "D. Renal + COVID"
)
)
library(ggplot2)
facet_plot <- ggplot(
facet_trend,
aes(x = Year, y = crude_rate, color = Group)
) +
# COVID shading (applies to all panels; only visible where relevant)
annotate(
"rect",
xmin = 2020, xmax = 2021.99,
ymin = -Inf, ymax = Inf,
fill = "grey70", alpha = 0.12
) +
geom_line(linewidth = 1.2) +
facet_wrap(~ Panel, scales = "free_y", ncol = 2) +
scale_color_manual(
values = c(
"AKI (N17)" = "#1b9e77",
"CKD (N18)" = "#7570b3",
"Unspecified renal failure (N19)" = "#d95f02",
"Sepsis (A40–A41)" = "#666666",
"COVID-19 (U07.1)" = "#4d4d4d"
)
) +
labs(
x = NULL,
y = "Crude mortality rate (per 100,000)",
color = NULL,
title = "Trends in renal failure, sepsis, and COVID-19–related mortality",
subtitle = "United States; shaded area indicates the COVID-19 period (2020–2021)"
) +
theme_minimal(base_size = 13) +
theme(
panel.grid.minor = element_blank(),
panel.grid.major.x = element_blank(),
axis.text = element_text(color = "black"),
strip.text = element_text(face = "bold"),
plot.title = element_text(face = "bold", size = 14),
legend.position = "bottom"
)
facet_plot
ggsave(
filename = "figures/fig_trends_facet.jpg",
plot = facet_plot,
device = "jpeg",
dpi = 600,
width = 10,
height = 8,
units = "in",
quality = 100
)
ggsave(
filename = "figures/fig_trends_facet.jpg",
plot = facet_plot,
device = "jpeg",
dpi = 600,
width = 12,
height = 8,
units = "in",
quality = 100
)
scale_color_manual(
values = c(
"AKI (N17)" = "#1b9e77",
"CKD (N18)" = "#7570b3",
"Unspecified renal failure (N19)" = "#d95f02",
"Sepsis (A40–A41)" = "#666666",     # gray
"COVID-19 (U07.1)" = "#1f78b4"      # distinct blue
)
)
facet_plot <- ggplot(facet_trend, aes(Year, crude_rate, color = Group, linetype = Group)) +
annotate("rect", xmin = 2020, xmax = 2021.99, ymin = -Inf, ymax = Inf,
fill = "grey70", alpha = 0.12) +
geom_line(linewidth = 1.2) +
facet_wrap(~ Panel, scales = "free_y", ncol = 2) +
scale_color_manual(values = c(
"AKI (N17)" = "#1b9e77",
"CKD (N18)" = "#7570b3",
"Unspecified renal failure (N19)" = "#d95f02",
"Sepsis (A40–A41)" = "#666666",
"COVID-19 (U07.1)" = "#1f78b4"
)) +
scale_linetype_manual(values = c(
"AKI (N17)" = "solid",
"CKD (N18)" = "solid",
"Unspecified renal failure (N19)" = "solid",
"Sepsis (A40–A41)" = "dashed",
"COVID-19 (U07.1)" = "solid"
)) +
labs(x = NULL, y = "Crude mortality rate (per 100,000)", color = NULL, linetype = NULL) +
theme_minimal(base_size = 13) +
theme(
panel.grid.minor = element_blank(),
panel.grid.major.x = element_blank(),
axis.text = element_text(color = "black"),
strip.text = element_text(face = "bold"),
legend.position = "bottom"
)
facet_plot
scale_color_manual(
values = c(
"AKI (N17)" = "#1b9e77",
"CKD (N18)" = "#7570b3",
"Unspecified renal failure (N19)" = "#d95f02",
"Sepsis (A40–A41)" = "#666666",   # solid gray
"COVID-19 (U07.1)" = "#1f78b4"    # solid blue
)
)
facet_plot <- ggplot(
facet_trend,
aes(x = Year, y = crude_rate, color = Group)
) +
annotate(
"rect",
xmin = 2020, xmax = 2021.99,
ymin = -Inf, ymax = Inf,
fill = "grey70", alpha = 0.12
) +
geom_line(linewidth = 1.2) +
facet_wrap(~ Panel, scales = "free_y", ncol = 2) +
scale_color_manual(
values = c(
"AKI (N17)" = "#1b9e77",
"CKD (N18)" = "#7570b3",
"Unspecified renal failure (N19)" = "#d95f02",
"Sepsis (A40–A41)" = "#666666",
"COVID-19 (U07.1)" = "#1f78b4"
)
) +
labs(
x = NULL,
y = "Crude mortality rate (per 100,000)",
color = NULL,
title = "Trends in renal failure, sepsis, and COVID-19–related mortality",
subtitle = "United States; shaded area indicates the COVID-19 period (2020–2021)"
) +
theme_minimal(base_size = 13) +
theme(
panel.grid.minor = element_blank(),
panel.grid.major.x = element_blank(),
axis.text = element_text(color = "black"),
strip.text = element_text(face = "bold"),
plot.title = element_text(face = "bold", size = 14),
legend.position = "bottom"
)
facet_plot
ggsave(
filename = "figures/fig_trends_facet.jpg",
plot = facet_plot,
device = "jpeg",
dpi = 600,
width = 12,
height = 8,
units = "in",
quality = 100
)
